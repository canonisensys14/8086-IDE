<head>

    <link rel="stylesheet" href="style.css">
    <meta charset="UTF-8">
  </head>

  <div class="template">
  <main>
<!-- the line bare here we display the number of lines on the code -->
<textArea class="list" id="count">1 </textArea>
      
    <!-- here you write the student or the teacher can write his/her code  -->
  <div class="container">

    <div class="backdrop">
      <div class="custom-area">
       
  
      </div>
    </div>
    
      <!-- the place where really write + controll the process of adding line or remove it from the code -->
    <textarea id="myTextArea" spellcheck="false" onkeydown="if(event.keyCode===9){
      var v=this.value,
      s=this.selectionStart,
      e=this.selectionEnd;
  
      this.value=v.substring(0, s)+'\t'+v.substring(e);this.selectionStart=this.selectionEnd=s+1;
      return false;
    }
      var count = document.getElementById('count');
      var count1 = document.getElementById('myTextArea')
      var nb=1;
      
       for(let i = 0; i<=this.value.length; i++)
      if(this.value[i] == '\n')nb++;
    
     if((event.keyCode === 13)){
      
      if(nb == 1) nb=2;
      else nb+=1
    count.value = count.value+'\n'+nb.toString();


 


}
"  onkeyup ="
      var count = document.getElementById('count');
      var count1 = document.getElementById('myTextArea')
      var nb=1;
          for(let i = 0; i<=this.value.length; i++)
      if(this.value[i] == '\n')nb++;
    
    if(event.keyCode == 8){
      if(nb >= 9){
        var last_line = count.value.substring(count.value.length -2);
        if (nb < parseInt(last_line)){
            count.value = count.value.substring(0, count.value.length -3);
        }
      }
      else if(nb < parseInt(count.value.substring(count.value.length -2)))
        count.value = count.value.substring(0, count.value.length -2);
    }
"></textarea>

  </div>


  </main> 
</div>

<!-- a button to highliting a specific line on the code -->

<button id="btn">click</button>


<!-- end designing the template -->

<!-- begining of the script -->
<script>
    
    // pointing on the element of the page

let textArea = document.getElementById("myTextArea");
let customArea = document.querySelector(".custom-area");
let backdrop = document.querySelector(".backdrop");
var index = 0;


 let directives = /(?<=\s+)org(?!\w)|(?<=\s+)define(?!\w)|(?<=\s+)equ(?!\w)|(?<=\s+)proc(?!\w)|(?<=\s+)local(?!\w)|(?<=\s+)endm(?!\w)|(?<=\s+)endp(?!\w)|(?<=\s+)offset(?!\w)/ig

 let instructions = /(?<=\s*)MOV(?!\w)|(?<=\s+)PUSH(?!\w)|(?<=\s+)POP(?!\w)|(?<=\s+)XCHG(?!\w)|(?<=\s+)LEA(?!\w)|(?<=\s+)LAHF(?!\w)|(?<=\s+)SAHF(?!\w)|(?<=\s+)PUSHF(?!\w)|(?<=\s+)POPF(?!\w)|(?<=\s+)ADD(?!\w)|(?<=\s+)ADC(?!\w)|(?<=\s+)DEC(?!\w)|(?<=\s+)INC(?!\w)|(?<=\s+)AAA(?!\w)|(?<=\s+)SUB(?!\w)|(?<=\s+)SSB(?!\w)|(?<=\s+)NEG(?!\w)|(?<=\s+)CMP(?!\w)|(?<=\s+)MUL(?!\w)|(?<=\s+)IMUL(?!\w)|(?<=\s+)DIV(?!\w)|(?<=\s+)IDIV(?!\w)|(?<=\s+)CBW(?!\w)|(?<=\s+)CWD(?!\w)|(?<=\s+)NOT(?!\w)|(?<=\s+)SHL(?!\w)|(?<=\s+)SAL(?!\w)|(?<=\s+)SHR(?!\w)|(?<=\s+)SAR(?!\w)|(?<=\s+)ROL(?!\w)|(?<=\s+)ROR(?!\w)|(?<=\s+)RCL(?!\w)|(?<=\s+)RCR(?!\w)|(?<=\s+)AND(?!\w)|(?<=\s+)TEST(?!\w)|(?<=\s+)OR(?!\w)|(?<=\s+)XOR(?!\w)|(?<=\s+)REP(?!\w)|(?<=\s+)MOVSB(?!\w)|(?<=\s+)CMPSB(?!\w)|(?<=\s+)SCASB(?!\w)|(?<=\s+)LODSB(?!\w)|(?<=\s+)STOSB(?!\w)|(?<=\s+)MOVSW(?!\w)|(?<=\s+)CMPSW(?!\w)|(?<=\s+)SCASW(?!\w)|(?<=\s+)LODSW(?!\w)|(?<=\s+)STOSW(?!\w)|(?<=\s+)CALL(?!\w)|(?<=\s+)JMP(?!\w)|(?<=\s+)RET(?!\w)|(?<=\s+)JE(?!\w)|(?<=\s+)JZ(?!\w)|(?<=\s+)JL(?!\w)|(?<=\s+)JNGE(?!\w)|(?<=\s+)JLE(?!\w)|(?<=\s+)JNG(?!\w)|(?<=\s+)JB(?!\w)|(?<=\s+)JNAE(?!\w)|(?<=\s+)JBE(?!\w)|(?<=\s+)JNA(?!\w)|(?<=\s+)JP(?!\w)|(?<=\s+)JPE(?!\w)|(?<=\s+)JO(?!\w)|(?<=\s+)JS(?!\w)|(?<=\s+)JNE(?!\w)|(?<=\s+)JNZ(?!\w)|(?<=\s+)JNL(?!\w)|(?<=\s+)JGE(?!\w)|(?<=\s+)JNLE(?!\w)|(?<=\s+)JG(?!\w)|(?<=\s+)JNB(?!\w)|(?<=\s+)JAE(?!\w)|(?<=\s+)JNBE(?!\w)|(?<=\s+)JA(?!\w)|(?<=\s+)JNP(?!\w)|(?<=\s+)JPO(?!\w)|(?<=\s+)JNO(?!\w)|(?<=\s+)JNS(?!\w)|(?<=\s+)LOOP(?!\w)|(?<=\s+)LOOPZ(?!\w)|(?<=\s+)LOOPE(?!\w)|(?<=\s+)LOOPNZ(?!\w)|(?<=\s+)LOOPNE(?!\w)|(?<=\s+)JCXZ(?!\w)|(?<=\s+)INT(?!\w)|(?<=\s+)db(?!\w)|(?<=\s+)dw(?!\w)/ig


 let registers = /(?<=\s+|,)ax(?!\w)|(?<=(\s+|\[|,))bx(?!\w)|(?<=\s+)cx(?!\w)|(?<=\s+|,)dx(?!\w)|(?<=\s+|,)sp(?!\w)|(?<=\s+|,)bp(?!\w)|(?<=\s+|,)si(?!\w)|(?<=\s+|,)di(?!\w)|(?<=\s+|,)al(?!\w)|(?<=\s+|,)ah(?!\w)|(?<=\s+|,)bh(?!\w)|(?<=\s+|,)bl(?!\w)|(?<=\s+|,)cl(?!\w)|(?<=\s+|,)ch(?!\w)|(?<=\s+|,)dh(?!\w)|(?<=\s+|,)dl(?!\w)|(?<=\s+|,)ip(?!\w)/ig

 
 textArea.addEventListener("keyup", function(event){
    var count = 0, string, index = 2;
    if(event.keyCode === 13)
    {
      let value = textArea.value;
      for(var i = 0; i < value.length; i++){
        if(value[i] == '\n') {
          count++; 
          string += value[i];}
        if(index == count) break;

      }


  

}}
    
  )
  
// Event listeners.

 // highliting the code    
    
    
textArea.addEventListener("input", function(e)
{
  let bool = false;

  customArea.innerHTML =applyColors(textArea.value, bool);

  let lignes = textArea.value.split("\n");
  var count = document.getElementById('count');
  var a = count.value.substring(count.value.length-1)

if (parseInt(a) < lignes.length){
  for(let i =1; i <= lignes.length - parseInt(a); i++){
      count.value += '\n'+(parseInt(a)+i).toString();
  }
}
    
else{
    count.value = count.value.substring(0, lignes.length*2) ;
}

})

    

    


var s1 = document.getElementById('myTextArea');
var s2 = document.getElementById('count');


// control scroll bar of the two text areas

function select_scroll_1(e) { s2.scrollTop = s1.scrollTop; }
function select_scroll_2(e) { s1.scrollTop = s2.scrollTop; }

s1.addEventListener('scroll', select_scroll_1, false);
s2.addEventListener('scroll', select_scroll_2, false);

textArea.addEventListener("scroll", function()
{
    backdrop.scrollTop = textArea.scrollTop;
});


let btn = document.getElementById("btn");

btn.addEventListener("click", function(){

  let clicked = true;
  customArea.innerHTML =applyColors(textArea.value, clicked)
  
 

})

    // applying colors on instructions, registers, numbers,..


function applyColors(text, bool)

{



text = text.applyhighliting(text, bool).replace(registers, function(m)
    {  
      //console.log(all_regex)
      let c = "orange"
   
        return `<span class="re">${m}</span>`;
    }).replace(directives, function(m){

       let c = "cyan"
   
        return `<span class="dir">${m}</span>`;

    }).replace(instructions, function(m){
      let c = "violet"
   
        return `<span class="ins">${m}</span>`;

    }).replace(/(?<=\s*)0x[0-9a-f]+(?!\w)|(?<=\s+)[a-f0-9](?!\w)+h|(?<=\s+)0b[0-1](?!\w)+|(?<=\s+)\d+(?!\w)/gi, function(m){
      
         return `<span class="digit">${m}</span>`
    }).replace(/(\;(.*)\n?)/gi, function(m){
      let c = "yellow"
       if(m.match(/\;{1,}<span class="ins">/giy)) m = m.replaceAll(/<span class="ins">/gi,`<span class="comments">`)
       if(m.match(/\;{1,}<span class="re">/giy)) m = m.replaceAll(/<span class="re">/gi,`<span class="comments">`)
       if(m.match(/\;{1,}<span class="dir">/giy)) m = m.replaceAll(/<span class="dir">/gi,`<span class="comments">`)
       
       if(m.match(/\s*<span class="ins">/gi)) {
        
        m = m.replaceAll(/<span class="ins">/gi,`<span class="comments">`)}
        if(m.match(/\s*<span class="re">/gi)) m = m.replaceAll(/<span class="re">/gi,`<span class="comments">`)
          if(m.match(/\s*<span class="dir">/gi)) m = m.replaceAll(/<span class="dir">/gi,`<span class="comments">`)

          if(m.match(/\;.*<span class="digit">/giy)) m = m.replace(/<span class="digit">/gi,`<span class="comments">` );

  
      
        return `<span class="comments">${m}</span>`;
        }).replace(/\[|\]/ig, function(m){
      return `<span class="accolade">${m}</span>`

})
.replace(/\'(.*)'?/gi, function(m){


          if(m.match(/\'{1,}<span class="ins">/giy)) m = m.replaceAll(/<span class="ins">/gi,`<span class="strings">`)
       if(m.match(/\'{1,}<span class="re">/giy)) m = m.replaceAll(/<span class="re">/gi,`<span class="strings">`) 
        
       if(m.match(/\'{1,}<span class="dir">/giy)) m = m.replaceAll(/<span class="dir">/gi,`<span class="strings">`)

       if(m.match(/\s*<span class="ins">/gi)) m = m.replaceAll(/<span class="ins">/gi,`<span class="strings">`)
        if(m.match(/\s*<span class="re">/gi)) m = m.replaceAll(/<span class="re">/gi,`<span class="strings">`)
          if(m.match(/\s*<span class="dir">/gi)) m = m.replaceAll(/<span class="dir">/gi,`<span class="strings">` );

         if(m.match(/\s*<span class="digit">/gi)) m = m.replaceAll(/<span class="digit">/gi,`<span class="strings">` );
          if(m.match(/\s*<span class="accolade">(\[|\])/gi)) {
            console.log(m);
            m = m.replaceAll(/<span class="accolade">/gi,`<span class="strings">` );
          }




          return `<span class="strings">${m}</span>`;
        }).replace(/(?<=\s+)".*"/gi, function(m){ 
      
         return `<span class="strings">${m}</span>`
})


        



return text;

}


String.prototype.applyhighliting = function applyhighliting(text, bool){

  if(bool){


  let a  = text.split("\n")

  

  //here you can apply highliting 
  if(a.length > index){
  let c = a[index]
  
  if(c.slice(0,7) =='</span>'){ c = c.slice(7, c.length) 
     



  c = `<span class="highliting">${c}</span>`

  
  
    a[index] = c
  }

    else { c = `<span class="highliting">${c}  </span>`

  
  
    a[index] = c
}


    text= a.join("\n");
console.log(text)

}

 
  }

   return text
}



</script>
